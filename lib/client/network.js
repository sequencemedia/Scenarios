'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _promise=require('babel-runtime/core-js/promise');var _promise2=_interopRequireDefault(_promise);var _extends2=require('babel-runtime/helpers/extends');var _extends3=_interopRequireDefault(_extends2);var _objectWithoutProperties2=require('babel-runtime/helpers/objectWithoutProperties');var _objectWithoutProperties3=_interopRequireDefault(_objectWithoutProperties2);var _regenerator=require('babel-runtime/regenerator');var _regenerator2=_interopRequireDefault(_regenerator);var _asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);exports.default=function(client){var _this=this;var onNetworkRequestWillBeSent=function onNetworkRequestWillBeSent(_ref3){var requestId=_ref3.requestId,request=_ref3.request,_ref3$request=_ref3.request,url=_ref3$request.url,method=_ref3$request.method;if(!_requestMap2.default.has(requestId)){_requestMap2.default.set(requestId,request);_logger2.default.info(_chalk2.default.cyan('Network.requestWillBeSent'),'\n',{requestId:requestId,url:(0,_transformUrl2.default)(url),method:method});}};var onNetworkResponseReceived=function onNetworkResponseReceived(_ref4){var requestId=_ref4.requestId,_ref4$response=_ref4.response,url=_ref4$response.url,status=_ref4$response.status,statusText=_ref4$response.statusText;if(_requestMap2.default.has(requestId)){_logger2.default.info(_chalk2.default.cyan('Network.responseReceived'),'\n',{requestId:requestId,url:(0,_transformUrl2.default)(url),status:status,statusText:statusText});}};var onNetworkLoadingFailed=function(){var _ref5=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee2(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var requestId=_ref6.requestId,response=(0,_objectWithoutProperties3.default)(_ref6,['requestId']);return _regenerator2.default.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!_requestMap2.default.has(requestId)){_context2.next=9;break;}_context2.t0=_logger2.default;_context2.t1=_chalk2.default.red('Network.loadingFailed');_context2.t2=(0,_extends3.default)({},response,{requestId:requestId});_context2.next=6;return getResponseBody(client,requestId);case 6:_context2.t3=_context2.sent;_context2.t0.info.call(_context2.t0,_context2.t1,'\n',_context2.t2,_context2.t3);_requestMap2.default.delete(requestId);case 9:case'end':return _context2.stop();}}},_callee2,_this);}));return function onNetworkLoadingFailed(){return _ref5.apply(this,arguments);};}();var onNetworkLoadingFinished=function onNetworkLoadingFinished(_ref7){var requestId=_ref7.requestId;// , ...response }) => { // Logger.info('Network.loadingFinished', { requestId, ...response });
if(_requestMap2.default.has(requestId)){_logger2.default.info(_chalk2.default.cyan('Network.loadingFinished'),'\n',{requestId:requestId});_requestMap2.default.delete(requestId);}};var attach=function attach(){return _promise2.default.resolve().then(function(){client.on('Network.requestWillBeSent',onNetworkRequestWillBeSent);client.on('Network.responseReceived',onNetworkResponseReceived);client.on('Network.loadingFailed',onNetworkLoadingFailed);client.on('Network.loadingFinished',onNetworkLoadingFinished);}).then(function(){client.send('Network.enable');});};var detach=function detach(){return _promise2.default.resolve().then(function(){client.send('Network.disable');}).then(function(){client.removeListener('Network.requestWillBeSent',onNetworkRequestWillBeSent);client.removeListener('Network.responseReceived',onNetworkResponseReceived);client.removeListener('Network.loadingFailed',onNetworkLoadingFailed);client.removeListener('Network.loadingFinished',onNetworkLoadingFinished);});};return{attach:attach,detach:detach};};var _chalk=require('chalk');var _chalk2=_interopRequireDefault(_chalk);var _logger=require('../logger');var _logger2=_interopRequireDefault(_logger);var _requestMap=require('../request-map');var _requestMap2=_interopRequireDefault(_requestMap);var _transformUrl=require('../transform-url');var _transformUrl2=_interopRequireDefault(_transformUrl);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var getResponseBody=function(){var _ref=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee(client,requestId){var _ref2,body;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return client.send('Network.getResponseBody',{requestId:requestId});case 2:_ref2=_context.sent;body=_ref2.body;return _context.abrupt('return',body);case 5:case'end':return _context.stop();}}},_callee,undefined);}));return function getResponseBody(_x,_x2){return _ref.apply(this,arguments);};}();