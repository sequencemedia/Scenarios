'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _regenerator=require('babel-runtime/regenerator');var _regenerator2=_interopRequireDefault(_regenerator);var _extends2=require('babel-runtime/helpers/extends');var _extends3=_interopRequireDefault(_extends2);var _objectWithoutProperties2=require('babel-runtime/helpers/objectWithoutProperties');var _objectWithoutProperties3=_interopRequireDefault(_objectWithoutProperties2);var _asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);var _captureScreenshot=require('../../../capture-screenshot');var _captureScreenshot2=_interopRequireDefault(_captureScreenshot);var _toBool=require('../../../to-bool');var _toBool2=_interopRequireDefault(_toBool);var _logger=require('../../../logger');var _logger2=_interopRequireDefault(_logger);var _step3ApplyCampaignCode=require('./step3-apply-campaign-code');var _step3ApplyCampaignCode2=_interopRequireDefault(_step3ApplyCampaignCode);var _step3ApplyBupaMember=require('./step3-apply-bupa-member');var _step3ApplyBupaMember2=_interopRequireDefault(_step3ApplyBupaMember);var _step3ApplyBrokerCode=require('./step3-apply-broker-code');var _step3ApplyBrokerCode2=_interopRequireDefault(_step3ApplyBrokerCode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}exports.default=function(){var _ref=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee(_ref2,_ref3){var _ref3$applyCampaignCo=_ref3.applyCampaignCode,campaignCode=_ref3$applyCampaignCo===undefined?false:_ref3$applyCampaignCo,_ref3$applyBupaMember=_ref3.applyBupaMember,bupaMember=_ref3$applyBupaMember===undefined?false:_ref3$applyBupaMember,_ref3$applyBrokerCode=_ref3.applyBrokerCode,brokerCode=_ref3$applyBrokerCode===undefined?false:_ref3$applyBrokerCode,params=(0,_objectWithoutProperties3.default)(_ref3,['applyCampaignCode','applyBupaMember','applyBrokerCode']);var page=_ref2.page,config=(0,_objectWithoutProperties3.default)(_ref2,['page']);var selector,_selector,_ref4$message,message;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(0,_toBool2.default)(campaignCode)){_context.next=4;break;}_context.next=4;return(0,_step3ApplyCampaignCode2.default)((0,_extends3.default)({},config,{page:page}),(0,_extends3.default)({},params,{applyCampaignCode:campaignCode,applyBupaMember:bupaMember,applyBrokerCode:brokerCode}));case 4:if(!(0,_toBool2.default)(bupaMember)){_context.next=7;break;}_context.next=7;return(0,_step3ApplyBupaMember2.default)((0,_extends3.default)({},config,{page:page}),(0,_extends3.default)({},params,{applyCampaignCode:campaignCode,applyBupaMember:bupaMember,applyBrokerCode:brokerCode}));case 7:if(!(0,_toBool2.default)(brokerCode)){_context.next=10;break;}_context.next=10;return(0,_step3ApplyBrokerCode2.default)((0,_extends3.default)({},config,{page:page}),(0,_extends3.default)({},params,{applyCampaignCode:campaignCode,applyBupaMember:bupaMember,applyBrokerCode:brokerCode}));case 10:/*
       *  Weirdness
       */selector=page.waitForSelector('[data-step-index="3"]',{visible:true});_context.next=13;return page.evaluate(function(){document.querySelector('[data-step-index="3"]').scrollIntoView({behaviour:'instant'});});case 13:_context.next=15;return selector;case 15:_context.next=17;return page.click('[data-step-index="3"]');case 17:_selector=page.waitForSelector('[data-step-index="3"] .proceed-to-checkout',{visible:true});_context.next=20;return page.evaluate(function(){document.querySelector('[data-step-index="3"] .proceed-to-checkout').scrollIntoView({behaviour:'instant'});});case 20:_context.next=22;return _selector;case 22:_context.next=24;return page.click('[data-step-index="3"] [data-tracking="cta:click:continue-to-checkout"] button.quote-cta-next');case 24:_context.next=33;break;case 26:_context.prev=26;_context.t0=_context['catch'](0);_ref4$message=_context.t0.message;message=_ref4$message===undefined?'No error message is defined':_ref4$message;_logger2.default.error('Error in Step 3. '+message.trim());_context.next=33;return(0,_captureScreenshot2.default)((0,_extends3.default)({},config,{page:page}),'step-3');case 33:case'end':return _context.stop();}}},_callee,undefined,[[0,26]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();