'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _regenerator=require('babel-runtime/regenerator');var _regenerator2=_interopRequireDefault(_regenerator);var _asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);var _puppeteer=require('puppeteer');var _puppeteer2=_interopRequireDefault(_puppeteer);var _travel=require('./travel');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var step2=_travel.step2.step2;var annual=function(){var _ref=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee2(page){var countries;return _regenerator2.default.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return page.focus('button[data-cover-type="travel"]');case 2:_context2.next=4;return page.click('button[data-cover-type="travel"]');case 4:_context2.next=6;return page.waitForSelector('.quote-input-container');case 6:_context2.next=8;return page.evaluate(function(){document.querySelector('.quote-input-container').scrollIntoView({behaviour:'instant'});});case 8:_context2.next=10;return page.waitForSelector('.quote-input-container',{visible:true});case 10:_context2.next=12;return page.focus('button[data-cover-period="annual"]');case 12:_context2.next=14;return page.click('button[data-cover-period="annual"]');case 14:_context2.next=16;return page.waitForSelector('.quote-input-country-container input.quote-input-country');case 16:_context2.next=18;return page.$$('.quote-input-country-container input.quote-input-country');case 18:countries=_context2.sent;countries.forEach(function(){var _ref2=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee(country){return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return country.focus();case 2:_context.next=4;return country.click();case 4:_context.next=6;return country.type('United Kingdom');case 6:case'end':return _context.stop();}}},_callee,undefined);}));return function(_x2){return _ref2.apply(this,arguments);};}());_context2.next=22;return page.waitForSelector('.quote-continue');case 22:_context2.next=24;return page.evaluate(function(){document.querySelector('.quote-continue').scrollIntoView({behaviour:'instant'});});case 24:_context2.next=26;return page.waitForSelector('.quote-continue',{visible:true});case 26:_context2.next=28;return page.focus('button[data-tracking="click:quote:step-0:cta:continue"]');case 28:_context2.next=30;return page.click('button[data-tracking="click:quote:step-0:cta:continue"]');case 30:case'end':return _context2.stop();}}},_callee2,undefined);}));return function annual(_x){return _ref.apply(this,arguments);};}();var step1=function(){var _ref3=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee3(page){return _regenerator2.default.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return page.waitForSelector('[data-step-index="1"]',{visible:true});case 2:_context3.next=4;return page.click('[data-step-index="1"]');case 4:_context3.next=6;return page.waitForSelector('[data-step-index="1"] .annual-insurance-period');case 6:_context3.next=8;return page.evaluate(function(){document.querySelector('[data-step-index="1"] .annual-insurance-period').scrollIntoView({behaviour:'instant'});});case 8:_context3.next=10;return page.waitForSelector('[data-step-index="1"] .annual-insurance-period',{visible:true});case 10:_context3.next=12;return page.focus('[data-step-index="1"] select#month-select');case 12:_context3.next=14;return page.click('[data-step-index="1"] select#month-select');case 14:_context3.next=16;return page.evaluate(function(){document.querySelector('[data-step-index="1"] select#month-select').selectedIndex=1;});case 16:_context3.next=18;return page.waitForSelector('[data-step-index="1"] .about-members');case 18:_context3.next=20;return page.evaluate(function(){document.querySelector('[data-step-index="1"] .about-members').scrollIntoView({behaviour:'instant'});});case 20:_context3.next=22;return page.waitForSelector('[data-step-index="1"] .about-members',{visible:true});case 22:_context3.next=24;return page.type('[data-step-index="1"] select#business-title','Mr');case 24:_context3.next=26;return page.type('[data-step-index="1"] input#first-name','Jonathan');case 26:_context3.next=28;return page.type('[data-step-index="1"] input#last-name','Perry');case 28:_context3.next=30;return page.type('[data-step-index="1"] input#date-day','15');case 30:_context3.next=32;return page.type('[data-step-index="1"] input#date-month','10');case 32:_context3.next=34;return page.type('[data-step-index="1"] input#date-year','1973');case 34:_context3.next=36;return page.click('[data-step-index="1"] button.cta-button');case 36:case'end':return _context3.stop();}}},_callee3,undefined);}));return function step1(_x3){return _ref3.apply(this,arguments);};}();exports.default=function(){var _ref4=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function _callee4(_ref5){var env=_ref5.env,_ref5$lang=_ref5.lang,lang=_ref5$lang===undefined?'en':_ref5$lang,_ref5$headless=_ref5.headless,headless=_ref5$headless===undefined?true:_ref5$headless;var browser,page;return _regenerator2.default.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _puppeteer2.default.launch({headless:headless});case 2:browser=_context4.sent;_context4.next=5;return browser.newPage();case 5:page=_context4.sent;_context4.next=8;return page.goto('http://'+env+'/'+lang+'/quote');case 8:_context4.next=10;return annual(page);case 10:_context4.next=12;return page.waitForNavigation();case 12:_context4.next=14;return step1(page);case 14:_context4.next=16;return step2(page);case 16:_context4.next=18;return(0,_travel.step3)(page);case 18:_context4.next=20;return(0,_travel.step4)(page);case 20:_context4.next=22;return page.waitForNavigation();case 22:_context4.next=24;return(0,_travel.altapay)(page);case 24:_context4.next=26;return page.waitForNavigation();case 26:_context4.next=28;return browser.close();case 28:case'end':return _context4.stop();}}},_callee4,undefined);}));return function(_x4){return _ref4.apply(this,arguments);};}();